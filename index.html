<!doctype html><html lang="fi"><meta charset="utf-8">
<title>LEMP-demo</title>

<style>
  html, body {
    height: 100%;
    margin: 0;
  }

  body {
    font-family: system-ui;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    background: #f8f9fa;
    line-height: 1.2;
    overflow: hidden;        /* estää sivun vierityksen */
  }

  h1 {
    margin: 0.5rem 0 0.25rem 0;
  }

  p {
    font-size: 1.25rem;
    margin: 0.3rem 0;
  }

  .time {
    font-weight: 700;
    color: #007bff;
    font-size: 1.5rem;
  }

  img {
    margin-top: 0.5rem;
    max-width: 90%;
    height: auto;
  }

  #scoreboard {
    margin-top: 0.5rem;
    font-weight: 600;
    font-size: 1rem;
  }

  canvas#game {
    margin-top: 0.5rem;
    border: 1px solid #ccc;
    background: #fff;
    width: 40vw;   /* täyttää lähes koko leveydeltä */
    height: 40vw;  /* pitää neliön muodon */
    max-width: 300px;
    max-height: 300px;
  }
</style>



<h1>Staattinen Nginx-sivun testailuja</h1>
<p>SQL-palvelimen aika: <span id="t" class="time">...</span></p>

<p><p></p>
<img src="LH2.gif" alt="Linux harjoitus GIF" width="400">
<p><p></p>

<!-- ===== LISÄYS: pistelaskuri + canvas TÄHÄN ===== -->
<div id="scoreboard">
  Pisteet: <span id="score">0</span> — Ennätys: <span id="best">0</span>
</div>
<canvas id="game" width="300" height="300"></canvas>
<!-- ===== LISÄYS LOPPU ===== -->

<script>
/* Ajan päivitys (nykyinen koodi) */
async function updateTime() {
  try {
    const r = await fetch('/time', {cache:'no-store'});
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const j = await r.json();
    document.getElementById('t').textContent = j.time || 'virhe';
  } catch(e) {
    document.getElementById('t').textContent = 'virhe';
  }
}
updateTime();
setInterval(updateTime, 1000);
</script>

<!-- ===== LISÄYS: matopeli + pistelaskuri TÄHÄN (uusi <script>) ===== -->
<script>
const c = document.getElementById('game');
const ctx = c.getContext('2d');
const box = 15;

let snake = [{x:150, y:150}];
let dir = 'RIGHT';
let food = spawnFood();
let score = 0;
let best = Number(localStorage.getItem('best') || 0);

const scoreEl = document.getElementById('score');
const bestEl  = document.getElementById('best');
bestEl.textContent = best;

// estetään selaimen vieritys nuolinäppäimillä
window.addEventListener('keydown', e => {
  if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", " "].includes(e.key)) {
    e.preventDefault();
  }
}, { passive: false });

document.addEventListener('keydown', e => {
  if (e.key === 'ArrowUp' && dir !== 'DOWN') dir = 'UP';
  if (e.key === 'ArrowDown' && dir !== 'UP') dir = 'DOWN';
  if (e.key === 'ArrowLeft' && dir !== 'RIGHT') dir = 'LEFT';
  if (e.key === 'ArrowRight' && dir !== 'LEFT') dir = 'RIGHT';
});

function spawnFood() {
  return {
    x: Math.floor(Math.random() * (c.width / box)) * box,
    y: Math.floor(Math.random() * (c.height / box)) * box
  };
}

function resetGame() {
  if (score > best) {
    best = score;
    localStorage.setItem('best', best);
    bestEl.textContent = best;
  }
  snake = [{x:150, y:150}];
  dir = 'RIGHT';
  food = spawnFood();
  score = 0;
  scoreEl.textContent = score;
}

function tick() {
  // tausta
  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, c.width, c.height);

  // ruoka
  ctx.fillStyle = '#dc3545';
  ctx.fillRect(food.x, food.y, box, box);

  // käärme
  ctx.fillStyle = '#198754';
  for (let s of snake) ctx.fillRect(s.x, s.y, box, box);

  // uusi pää
  let head = {...snake[0]};
  if (dir === 'UP') head.y -= box;
  if (dir === 'DOWN') head.y += box;
  if (dir === 'LEFT') head.x -= box;
  if (dir === 'RIGHT') head.x += box;

  // törmäykset
  if (
    head.x < 0 || head.y < 0 ||
    head.x >= c.width || head.y >= c.height ||
    snake.some(s => s.x === head.x && s.y === head.y)
  ) {
    resetGame();
    return;
  }

  snake.unshift(head);

  // söikö ruoan?
  if (head.x === food.x && head.y === food.y) {
    score += 1;
    scoreEl.textContent = score;
    food = spawnFood();
  } else {
    snake.pop();
  }
}

setInterval(tick, 120);
</script>
<!-- ===== LISÄYS LOPPU ===== -->
